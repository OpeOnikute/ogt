{% load staticfiles %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>OGT {% block title %}{% endblock %}</title>
  <meta name="description" content="Responsive, Bootstrap, BS4" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimal-ui" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <!-- for ios 7 style, multi-resolution icon of 152x152 -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-barstyle" content="black-translucent">
  <link rel="apple-touch-icon" href="images/logo.png">
  <meta name="apple-mobile-web-app-title" content="Flatkit">
  <!-- for Chrome on Android, multi-resolution icon of 196x196 -->
  <meta name="mobile-web-app-capable" content="yes">
  <link rel="shortcut icon" sizes="196x196" href="images/logo.png">

  <!-- style -->
  <link rel="stylesheet" href="{% static "css/animate.css/animate.min.css" %}" type="text/css" />
  <link rel="stylesheet" href="{% static "css/glyphicons/glyphicons.css" %}" type="text/css" />
  <link rel="stylesheet" href="{% static "css/font-awesome/css/font-awesome.min.css" %}" type="text/css" />
  <link rel="stylesheet" href="{% static "css/material-design-icons/material-design-icons.css" %}" type="text/css" />
  <link rel="stylesheet" href="{% static "css/ionicons/css/ionicons.min.css" %}" type="text/css" />
  <link rel="stylesheet" href="{% static "css/simple-line-icons/css/simple-line-icons.css" %}" type="text/css" />
  <link rel="stylesheet" href="{% static "css/bootstrap/dist/css/bootstrap.min.css" %}" type="text/css" />

  <!-- build:css css/styles/app.min.css -->
  <link rel="stylesheet" href="{% static "css/styles/app.css" %}" type="text/css" />
  <!-- endbuild -->
  <link rel="stylesheet" href="{% static "css/styles/font.css" %}" type="text/css" />

    {% block header_scripts %}{% endblock %}
  <link rel="stylesheet" href="{% static "css/styles/style.css" %}" type="text/css" />

</head>
<body>
  <div class="app" id="app">

<!-- ############ LAYOUT START-->

  <!-- aside -->
  <div id="aside" class="app-aside fade nav-dropdown black">
    <!-- fluid app aside -->
    <div class="navside dk" data-layout="column">
      <div class="navbar no-radius">
        <!-- brand -->
        <a href="index.html" class="navbar-brand">
        	<div data-ui-include="'images/logo.svg'"></div>
        	<img src="{% static "images/logo.png" %}" alt="." class="hide">
        	<span class="hidden-folded inline">aside</span>
        </a>
        <!-- / brand -->
      </div>
      <div data-flex class="hide-scroll">
          <nav class="scroll nav-stacked nav-stacked-rounded nav-color">
            <ul class="nav" data-ui-nav>
              <li class="nav-header hidden-folded">
                <span class="text-xs">Main</span>
              </li>
              <li>
                <a href="{% url 'dashboard:index' %}" class="b-danger">
                  <span class="nav-icon text-white no-fade">
                    <i class="ion-filing"></i>
                  </span>
                  <span class="nav-text">Dashboard</span>
                </a>
              </li>
              <li>
                <a href="{% url 'dashboard:projects' %}" class="b-success">
                  <span class="nav-icon text-white no-fade">
                    <i class="ion-android-apps"></i>
                  </span>
                  <span class="nav-text">Projects</span>
                </a>
              </li>
              <li>
                <a href="{% url 'dashboard:messaging' %}" class="b-info">
                  <span class="nav-icon text-white no-fade">
                    <i class="ion-email"></i>
                  </span>
                  <span class="nav-text">Messaging</span>
                </a>
              </li>
               <li>
                <a href="{% url 'dashboard:clients' %}" class="b-default">
                  <span class="nav-icon">
                    <i class="ion-person"></i>
                  </span>
                  <span class="nav-text">Clients</span>
                </a>
              </li>
              <li>
                <a href="{% url 'dashboard:potential_clients' %}" class="b-default">
                  <span class="nav-icon">
                    <i class="ion-person-add"></i>
                  </span>
                  <span class="nav-text">Potential Clients</span>
                </a>
              </li>
                <li>
                <a href="{% url 'dashboard:pricing' %}" class="b-default">
                  <span class="nav-icon">
                    <i class="ion-cash"></i>
                  </span>
                  <span class="nav-text">Pricing</span>
                </a>
              </li>

                <li class="nav-header hidden-folded m-t">
                <span class="text-xs">Other Options</span>
              </li>

              <li>
                <a>
                  <span class="nav-caret">
                    <i class="fa fa-caret-down"></i>
                  </span>
                  <span class="nav-icon">
                    <i class="ion-ios-photos"></i>
                  </span>
                  <span class="nav-text">Pages</span>
                </a>
                <ul class="nav-sub nav-mega">
                  <li>
                    <a href="profile.html" >
                      <span class="nav-text">Profile</span>
                    </a>
                  </li>
                  <li>
                    <a href="setting.html" >
                      <span class="nav-text">Setting</span>
                    </a>
                  </li>
                  <li>
                    <a href="search.html" >
                      <span class="nav-text">Search</span>
                    </a>
                  </li>
                  <li>
                    <a href="faq.html" >
                      <span class="nav-text">FAQ</span>
                    </a>
                  </li>
                  <li>
                    <a href="gallery.html" >
                      <span class="nav-text">Gallery</span>
                    </a>
                  </li>
                  <li>
                    <a href="invoice.html" >
                      <span class="nav-text">Invoice</span>
                    </a>
                  </li>
                  <li>
                    <a href="price.html" >
                      <span class="nav-text">Price</span>
                    </a>
                  </li>
                  <li>
                    <a href="blank.html" >
                      <span class="nav-text">Blank</span>
                    </a>
                  </li>
                  <li>
                    <a href="login.html" >
                      <span class="nav-text">Sign In</span>
                    </a>
                  </li>
                  <li>
                    <a href="signup.html" >
                      <span class="nav-text">Sign Up</span>
                    </a>
                  </li>
                  <li>
                    <a href="forgot-password.html" >
                      <span class="nav-text">Forgot Password</span>
                    </a>
                  </li>
                  <li>
                    <a href="lockme.html" >
                      <span class="nav-text">Lockme Screen</span>
                    </a>
                  </li>
                  <li>
                    <a href="404.html" >
                      <span class="nav-text">Error 404</span>
                    </a>
                  </li>
                  <li>
                    <a href="505.html" >
                      <span class="nav-text">Error 505</span>
                    </a>
                  </li>
                </ul>
              </li>
            </ul>
          </nav>
      </div>
      <div data-flex-no-shrink>
        <div class="nav-fold dropup">
          <a data-toggle="dropdown">
              <div class="pull-left">
                <div class="inline"><span class="avatar w-40 grey">JR</span></div>
                <img src="images/a0.jpg" alt="..." class="w-40 img-circle hide">
              </div>
              <div class="clear hidden-folded p-x">
                <span class="block _500 text-muted">Jean Reyes</span>
                <div class="progress-xxs m-y-sm lt progress">
                    <div class="progress-bar info" style="width: 15%;">
                    </div>
                </div>
              </div>
          </a>
            {% if request.user.is_authenticated %}
          <div class="dropdown-menu w dropdown-menu-scale ">
            <a class="dropdown-item" href="profile.html">
              <span>Profile</span>
            </a>
            <a class="dropdown-item" href="setting.html">
              <span>Settings</span>
            </a>
            <a class="dropdown-item" href="app.inbox.html">
              <span>Inbox</span>
            </a>
            <a class="dropdown-item" href="messaging.html">
              <span>Message</span>
            </a>
            <div class="dropdown-divider"></div>
            <a class="dropdown-item" href="docs.html">
              Need help?
            </a>
            <a class="dropdown-item" href="{% url 'dashboard:logout' %}">Sign out</a>
          </div>
            {% else %}
            <div class="dropdown-menu w dropdown-menu-scale">
                <a class="dropdown-item" href="#">
                    <span>Login</span>
                </a>
                <div class="dropdown-divider"></div>
                <a class="dropdown-item" href="#">Need help?</a>
            </div>
            {% endif %}
        </div>
      </div>
    </div>
  </div>
  <!-- / -->

  <!-- content -->
{% block content %}

{% endblock %}

<!-- ############ PAGE END-->

    </div>
  <!-- / -->
   {#the confirm delete modal is used in more than one place#}
       <div class="modal fade" id="confirm-delete" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h4>Confirm Deletion</h4>
                </div>
                <div class="modal-body">
                    <p>Are you sure?</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                    <a class="btn btn-danger btn-ok delete-btn">Confirm</a>
                </div>
            </div>
        </div>
       </div>
  <div class="modal fade" id="add-client-modal">
	<div class="modal-dialog modal-lg">
	  	<div class="modal-content">
	  		<div class="modal-header _600">
	  			<button type="button" class="close" data-dismiss="modal" aria-label="Close">
		          <span aria-hidden="true">&times;</span>
		        </button>
	  			New Client
	  		</div>
	  		<div class="modal-body">
                <div id="add-client-modal-error-display" style="display: none;">
                    <p><small>The form was invalid. Please correct the following issues:</small></p>
                </div>
			    <form class="form-horizontal" method="post" id="add-client-form">
                    {% csrf_token %}
                    <input type="text" name="modal-type" value="ClientForm" class="form-control" hidden>
                    <input type="number" name="user" value="{{ user.id }}"  hidden>
				    <div class="form-group row">
				        <label class="col-lg-2 form-control-label">Name:</label>
				        <div class="col-lg-8">
					        <input type="text" class="form-control" name="name" required>
				        </div>
				    </div>
				    <div class="form-group row">
				        <label class="col-lg-2 form-control-label">Email:</label>
				        <div class="col-lg-8">
				          	<input type="email" class="form-control" name="email" required>
				        </div>
				    </div>
				    <div class="form-group row">
				        <label class="col-lg-2 form-control-label">Phone number:</label>
                        <div class="col-lg-8">
                            <input type="tel" class="form-control" name="phone_number" required>
                        </div>
				    </div>
				    <div class="form-group row">
				        <div class="col-lg-8 offset-lg-2">
				          	<button type="submit" class="btn primary btn-sm p-x-md">Save</button>
				        </div>
				    </div>
			    </form>
		    </div>
	  	</div>
  	</div>
</div>

<div class="modal fade" id="modal-success">
  <div class="modal-dialog modal-sm text-center">
      <div class="modal-content">
        <div class="modal-body">
            <img src="{% static 'images/icons/success_icon_med.png' %}">
            <p class="modal-message"></p>
        </div>
      </div>
    </div>
</div>
  <div class="modal fade" id="modal-error">
  <div class="modal-dialog modal-sm text-center">
      <div class="modal-content">
        <div class="modal-body">
            <img src="{% static 'images/icons/error_icon_med.png' %}">
            <p class="modal-message"></p>
        </div>
      </div>
    </div>
</div>
   {% block modals %}
   {% endblock %}

  <!-- ############ SWITCHER START-->
    <div id="switcher">
      <div class="switcher dark-white" id="sw-theme">
        <a href="#" data-ui-toggle-class="active" data-ui-target="#sw-theme" class="dark-white sw-btn">
          <i class="fa fa-gear text-muted"></i>
        </a>
        <div class="box-header">
          <a href="https://themeforest.net/item/aside-dashboard-ui-kit/17903768?ref=flatfull" class="btn btn-xs rounded danger pull-right">BUY</a>
          <strong>Theme Switcher</strong>
        </div>
        <div class="box-divider"></div>
        <div class="box-body">
          <p id="settingLayout" class="hidden-md-down">
            <label class="md-check m-y-xs" data-target="folded">
              <input type="checkbox">
              <i></i>
              <span>Folded Aside</span>
            </label>
            <label class="m-y-xs pointer" data-ui-fullscreen data-target="fullscreen">
              <span class="fa fa-expand fa-fw m-r-xs"></span>
              <span>Fullscreen Mode</span>
            </label>
          </p>
          <p>Colors:</p>
          <p data-target="color">
            <label class="radio radio-inline m-a-0 ui-check ui-check-color ui-check-md">
              <input type="radio" name="color" value="primary">
              <i class="primary"></i>
            </label>
            <label class="radio radio-inline m-a-0 ui-check ui-check-color ui-check-md">
              <input type="radio" name="color" value="accent">
              <i class="accent"></i>
            </label>
            <label class="radio radio-inline m-a-0 ui-check ui-check-color ui-check-md">
              <input type="radio" name="color" value="warn">
              <i class="warn"></i>
            </label>
            <label class="radio radio-inline m-a-0 ui-check ui-check-color ui-check-md">
              <input type="radio" name="color" value="success">
              <i class="success"></i>
            </label>
            <label class="radio radio-inline m-a-0 ui-check ui-check-color ui-check-md">
              <input type="radio" name="color" value="info">
              <i class="info"></i>
            </label>
            <label class="radio radio-inline m-a-0 ui-check ui-check-color ui-check-md">
              <input type="radio" name="color" value="warning">
              <i class="warning"></i>
            </label>
            <label class="radio radio-inline m-a-0 ui-check ui-check-color ui-check-md">
              <input type="radio" name="color" value="danger">
              <i class="danger"></i>
            </label>
          </p>
          <p>Themes:</p>
          <div data-target="bg" class="clearfix">
            <label class="radio radio-inline m-a-0 ui-check ui-check-lg">
              <input type="radio" name="theme" value="">
              <i class="light"></i>
            </label>
            <label class="radio radio-inline m-a-0 ui-check ui-check-color ui-check-lg">
              <input type="radio" name="theme" value="grey">
              <i class="grey"></i>
            </label>
            <label class="radio radio-inline m-a-0 ui-check ui-check-color ui-check-lg">
              <input type="radio" name="theme" value="dark">
              <i class="dark"></i>
            </label>
            <label class="radio radio-inline m-a-0 ui-check ui-check-color ui-check-lg">
              <input type="radio" name="theme" value="black">
              <i class="black"></i>
            </label>
          </div>
        </div>
      </div>
    </div>
  <!-- ############ SWITCHER END-->


<!-- ############ LAYOUT END-->
<!-- build:js scripts/app.min.js -->
<!-- jQuery -->
  <script src="{% static "libs/jquery/dist/jquery.js" %}"></script>
<!-- Bootstrap -->
  <script src="{% static "libs/tether/dist/js/tether.min.js" %}"></script>
  <script src="{% static "libs/bootstrap/dist/js/bootstrap.js" %}"></script>
<!-- core -->
  <script src="{% static "libs/jQuery-Storage-API/jquery.storageapi.min.js" %}"></script>
  <script src="{% static "libs/PACE/pace.min.js" %}"></script>
  <script src="{% static "libs/jquery-pjax/jquery.pjax.js" %}"></script>
  <script src="{% static "libs/blockUI/jquery.blockUI.js" %}"></script>
  <script src="{% static "libs/jscroll/jquery.jscroll.min.js" %}"></script>

  <script src="{% static "scripts/config.lazyload.js" %}"></script>
{#  <script src="{% static "scripts/ui-load.js" %}"></script>#}
{#  <script src="{% static "scripts/ui-jp.js" %}"></script>#}
{#  <script src="{% static "scripts/ui-include.js" %}"></script>#}
{#  <script src="{% static "scripts/ui-device.js" %}"></script>#}
{#  <script src="{% static "scripts/ui-form.js" %}"></script>#}
{#  <script src="{% static "scripts/ui-modal.js" %}"></script>#}
{#  <script src="{% static "scripts/ui-nav.js" %}"></script>#}
{#  <script src="{% static "scripts/ui-list.js" %}"></script>#}
{#  <script src="{% static "scripts/ui-screenfull.js" %}"></script>#}
  <script src="{% static "scripts/ui-scroll-to.js" %}"></script>
  <script src="{% static "scripts/ui-toggle-class.js" %}"></script>
  <script src="{% static "scripts/ui-taburl.js" %}"></script>
  <script src="{% static "scripts/app.js" %}"></script>
  <script src="{% static "scripts/ajax.js" %}"></script>
   {#the script to add the url to confirm delete button is used in more than one place also #}
      <script>

          function save_objects(){
             $('.ajax-update').on('submit', function(e){
                e.preventDefault();

                var form = $(e.target);
                var modal = form.parents().eq(3);

                $.ajax({
                    url: "{% url 'dashboard:ajax_save' %}",
                    type: "POST",
                    data: form.serialize(),
                    dataType: "json",
                    beforeSend: function(){
                        form.find('button:submit').addClass('disabled').attr('disabled', true);
                    },
                    success: function(data){
                        form.find('button:submit').removeClass('disabled').attr('disabled', false);

                        if (data.status == "success"){
                            //Close the modal
                            modal.modal("toggle");

                            displayModalResponse(1);

                        } else {
                            var error_wrap = form.find('.error_wrap');

                            if(typeof data.message === 'object'){
                                //Display the errors gotten from Python forms

                                error_wrap.append(
                                    '<p>Welp. There was an error processing your form. Please correct the following:</p>'
                                );

                                $.each(data.message, function(index, value){
                                    error_wrap.append(
                                        '<div class="error">' +
                                        '<p><span style="padding-right: 10px;">' + index + ':</span>' + value + '</p>' +
                                        '</div>'
                                    );
                                });
                            } else {
                                 error_wrap.append(
                                     '<div class="error">' +
                                     '<p>' + data.message + '</p>' +
                                     '</div>'
                                 );
                            }
                        }
                    },
                    error: function(err){
                        console.log(err.responseText);
                        form.find('.error_wrap').append(
                            '<div class="error">' +
                            '<p>' + err.responseText + '</p>' +
                            '</div>'
                        );
                    }
                });
            });
          }

          function update_objects(){
              $('.update-object').on('click', function(e){
                  e.preventDefault();

                  var update_link  = $(this);
                  var parent = update_link.parent();

                  var object_type = $(parent).data('type');
                  var object_id = $(parent).data('id');

                  var value = update_link.data('value');
                  var label = update_link.data('label');

                  $.ajax({
                      url: window.location.origin + "/dashboard/actions/" + object_type + '/' + object_id,
                      method: "put",
                      data: {
                          "value": value
                      },
                      dataType: "json",
                      success: function(response){

                          if(response.status == 'error'){
                              displayModalResponse(0, response.message);
                              return;
                          }

                          //Update the DOM on success
                          var dropdown = update_link.parents().eq(2).find('a.dropdown-info');
                          $(dropdown).empty().append('<span class="label ' + label + ' rounded dropdown-toggle">' + value + '</span>');

                      },
                      error: function(err){
                          displayModalResponse(0, 'Something went wrong and the update didn\'t happen. Please try again.');
                          console.log(err.responseText);
                      }
                  });
              });
          }
{##}
{#          function trigger_save_action(modal_id){#}
{#            $(modal_id).modal("toggle");#}
{##}
{#            //Find the form inside the modal#}
{#            var modal_form_id = $(modal_id).find("form").selector;#}
{##}
{#            if(modal_form_id){#}
{#                 $(modal_form_id).on('submit', function(e){#}
{#                    e.preventDefault();#}
{#                    $(this).find('.btn').addClass('disabled');#}
{#                    var form_inputs = this.elements;#}
{#                    var form_data = {};#}
{##}
{#                    jQuery.each(form_inputs, function(index, val){#}
{#                        //populate the form data#}
{#                        var input_name = val.name;#}
{#                        form_data[input_name] = val.value;#}
{#                    });#}
{##}
{#                    $.ajax({#}
{#                        url: "{% url 'dashboard:ajax_save' %}",#}
{#                        type: "POST",#}
{#                        data: form_data,#}
{#                        dataType: "json",#}
{#                        beforeSend: function(){#}
{#                        },#}
{#                        success: function(data){#}
{#                            $(modal_form_id).find('.btn').removeClass('disabled');#}
{##}
{#                            if (data.status == "success"){#}
{#                                //Close the modal#}
{#                                $(modal_id).modal("toggle");#}
{##}
{#                                displayModalResponse(1);#}
{##}
{#                                setTimeout(function(){#}
{#                                    window.location = '{% url "dashboard:messaging" %}';#}
{#                                }, 5000);#}
{##}
{#                                //TO-DO: Trigger the success modal#}
{#                            } else {#}
{##}
{#                                if( typeof data.message === 'object'){#}
{##}
{#                                    //Remove all previously shown errors#}
{#                                    $(modal_id + "-error-display").find('div').remove();#}
{##}
{#                                    jQuery.each(data.message, function(field, error){#}
{##}
{#                                        var error_message = field + ": " + error[0];#}
{##}
{#                                        $(modal_id + "-error-display").append('<div class="alert alert-danger"><p>' + error_message + '</p></div>');#}
{##}
{#                                        $(modal_id + "-error-display").fadeIn();#}
{##}
{#                                        //remove all errors after five seconds#}
{#                                        setTimeout(function(){#}
{#                                            $(modal_id + "-error-display").fadeOut();#}
{#                                            $(modal_id + "-error-display").find('div').fadeOut();#}
{#                                        }, 10000);#}
{#                                    });#}
{#                                }#}
{#                            }#}
{#                        },#}
{#                        error: function(err){#}
{#                            console.log(err.responseText);#}
{#                            displayModalResponse(0);#}
{#                        }#}
{#                    });#}
{#                 });#}
{#            } else {#}
{#                $(modal_id).modal("toggle");#}
{#                displayModalResponse(1);#}
{#            }#}
{#          }#}

          $('#confirm-delete').on('show.bs.modal', function(e) {
              $(this).find('.btn-ok').attr('href', $(e.relatedTarget).data('href'));

              var object_type = $(e.relatedTarget).data('type');
              var object_id = $(e.relatedTarget).data('id');

              $.ajax({
                  url: window.location.origin + '/dashboard/actions/' + object_type + '/' + object_id,
                  method: "delete",
                  dataType: "json",
                  beforeSend: function(){

                  },
                  success: function(response){
                      console.log(response);
                  },
                  error: function(err){
                      console.log(err.responseText);
                  }
              })
          });

          /**
           * Displays a modal response after an action
           * @param type
           * @param message
           * @param modal_id
           */
          function displayModalResponse(type, message, modal_id){

              var id = '';

              if (type == 1){
                  //show success
                  id = typeof (modal_id) == "undefined" ? 'modal-success' : modal_id;
                  message = (typeof (message) == "undefined") ? "Your data was saved successfully." : message;

              } else if (type == 0){
                  //show error
                  id = typeof (modal_id) == "undefined" ? 'modal-error' : modal_id;
                  message = (typeof (message) == "undefined") ? "An error occured. Please try again." : message;
              }

              var modal = $('#' + id);
              var notification = modal.find('.modal-message')[0];

              $(notification).html(message);

              modal.modal("toggle");

              setTimeout(function(){
                  modal.modal("toggle");
              }, 3000);
          }

          $(document).ready(function(){

              save_objects();
              update_objects();

               $.blockUI.defaults.css = {
                  padding: 0,
                  margin: 0,
                  width: '30%',
                  top: '40%',
                  left: '35%',
                  textAlign: 'center',
                  cursor: 'wait'
              };
          });
    </script>
  {% block base_scripts %}{% endblock %}
<!-- endbuild -->
</body>
</html>
